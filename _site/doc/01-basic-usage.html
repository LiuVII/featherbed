<!DOCTYPE html>
<html lang="en-us">
  
  <head>
  <meta charset="UTF-8">
  <title>featherbed</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <link rel="stylesheet" href="/featherbed/css/normalize.css">
  <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/featherbed/css/cayman.css">
  <link rel="stylesheet" href="/featherbed/css/code.css">
</head>


  <body>
    <section class="page-header">
  <h1 class="project-name">featherbed</h1>
  <h2 class="project-tagline">Asynchronous Scala HTTP client using Finagle, Shapeless and Cats</h2>
  <a href="https://github.com/jeremyrsmith/featherbed" class="btn">View on GitHub</a>
</section>


    <section class="main-content">
      
      <h1 id="basic-usage">Basic Usage</h1>

<p>Assuming an HTTP server exists at <code class="highlighter-rouge">localhost:8765</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.twitter.util.Future</span>
<span class="c1">// import com.twitter.util.Future
</span>
<span class="k">import</span> <span class="nn">com.twitter.finagle.</span><span class="o">{</span><span class="nc">Service</span><span class="o">,</span><span class="nc">Http</span><span class="o">}</span>
<span class="c1">// import com.twitter.finagle.{Service, Http}
</span>
<span class="k">import</span> <span class="nn">com.twitter.finagle.http.</span><span class="o">{</span><span class="nc">Request</span><span class="o">,</span><span class="nc">Response</span><span class="o">}</span>
<span class="c1">// import com.twitter.finagle.http.{Request, Response}
</span>
<span class="k">import</span> <span class="nn">java.net.InetSocketAddress</span>
<span class="c1">// import java.net.InetSocketAddress
</span>
<span class="k">val</span> <span class="n">server</span> <span class="k">=</span> <span class="nc">Http</span><span class="o">.</span><span class="n">serve</span><span class="o">(</span><span class="k">new</span> <span class="nc">InetSocketAddress</span><span class="o">(</span><span class="mi">8765</span><span class="o">),</span> <span class="k">new</span> <span class="nc">Service</span><span class="o">[</span><span class="kt">Request</span>, <span class="kt">Response</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">request</span><span class="k">:</span> <span class="kt">Request</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">Response</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Future</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">rep</span> <span class="k">=</span> <span class="nc">Response</span><span class="o">()</span>
    <span class="n">rep</span><span class="o">.</span><span class="n">contentString</span> <span class="k">=</span> <span class="n">s</span><span class="s">"${request.method} ${request.uri} :: ${request.contentString}"</span>
    <span class="n">rep</span>
  <span class="o">}</span>
<span class="o">})</span>
<span class="c1">// server: com.twitter.finagle.ListeningServer = Group(/0:0:0:0:0:0:0:0:8765)
</span></code></pre>
</div>

<p>Create a <code class="highlighter-rouge">Client</code>, passing the base URL to the REST endpoints:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.net.URL</span>
<span class="c1">// import java.net.URL
</span>
<span class="k">val</span> <span class="n">client</span> <span class="k">=</span> <span class="k">new</span> <span class="n">featherbed</span><span class="o">.</span><span class="nc">Client</span><span class="o">(</span><span class="k">new</span> <span class="nc">URL</span><span class="o">(</span><span class="s">"http://localhost:8765/api/"</span><span class="o">))</span>
<span class="c1">// client: featherbed.Client = featherbed.Client@273e4593
</span></code></pre>
</div>
<p><em>Note:</em> It is important to put a trailing slash on your URL.  This is because the resource path you’ll pass in below
is evaluated as a relative URL to the base URL given.  Without a trailing slash, the <code class="highlighter-rouge">api</code> directory above would be
lost when the relative URL is resolved.</p>

<p>Now you can make some requests:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.twitter.util.Await</span>
<span class="c1">// import com.twitter.util.Await
</span>
<span class="nc">Await</span><span class="o">.</span><span class="n">result</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">request</span> <span class="k">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">"test/resource"</span><span class="o">)</span>
  <span class="n">request</span> <span class="n">map</span> <span class="o">{</span>
    <span class="n">response</span> <span class="k">=&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">contentString</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// res0: String = "GET /api/test/resource :: "
</span></code></pre>
</div>

<p>The result of making a request is a <code class="highlighter-rouge">Future</code> that must be mapped (or <code class="highlighter-rouge">flatMap</code>ped) over.  Normally, you wouldn’t use
<code class="highlighter-rouge">Await</code> in real code, because you don’t want to block Finagle’s event loop.  But here, it demonstrates the result of
mapping the <code class="highlighter-rouge">Future[Response]</code> to a <code class="highlighter-rouge">Future[String]</code> which will contain the response’s content.</p>

<p>Besides <code class="highlighter-rouge">get</code>, the other REST verbs are also available; the process of specifying a request has a fluent API which
can be used to fine-tune the request that will be sent.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.nio.charset.StandardCharsets._</span>
<span class="c1">// import java.nio.charset.StandardCharsets._
</span>
<span class="nc">Await</span><span class="o">.</span><span class="n">result</span> <span class="o">{</span>
  <span class="n">client</span>
    <span class="o">.</span><span class="n">post</span><span class="o">(</span><span class="s">"another/resource"</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withForm</span><span class="o">(</span>
      <span class="s">"foo"</span> <span class="o">-&gt;</span> <span class="s">"foz"</span><span class="o">,</span>
      <span class="s">"bar"</span> <span class="o">-&gt;</span> <span class="s">"baz"</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withCharset</span><span class="o">(</span><span class="nc">UTF_8</span><span class="o">)</span>
    <span class="o">.</span><span class="n">withHeaders</span><span class="o">(</span><span class="s">"X-Foo"</span> <span class="o">-&gt;</span> <span class="s">"scooby-doo"</span><span class="o">)</span>
    <span class="o">.</span><span class="n">map</span> <span class="o">{</span>
      <span class="n">response</span> <span class="k">=&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">contentString</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// res1: String = POST /api/another/resource :: foo=foz&amp;bar=baz
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">Await</span><span class="o">.</span><span class="n">result</span> <span class="o">{</span>
  <span class="n">client</span><span class="o">.</span><span class="n">head</span><span class="o">(</span><span class="s">"head/request"</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">headerMap</span><span class="o">)</span>
<span class="o">}</span>
<span class="c1">// res2: com.twitter.finagle.http.HeaderMap = Map(Content-Length -&gt; 26)
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.twitter.io.Buf</span>
<span class="c1">// import com.twitter.io.Buf
</span>
<span class="nc">Await</span><span class="o">.</span><span class="n">result</span> <span class="o">{</span>
  <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="o">(</span><span class="s">"put/request"</span><span class="o">).</span><span class="n">withContent</span><span class="o">(</span><span class="nc">Buf</span><span class="o">.</span><span class="nc">Utf8</span><span class="o">(</span><span class="s">"Hello world!"</span><span class="o">),</span> <span class="s">"text/plain"</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span>
    <span class="n">response</span> <span class="k">=&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">statusCode</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// res3: Int = 200
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="nc">Await</span><span class="o">.</span><span class="n">result</span> <span class="o">{</span>
  <span class="n">client</span><span class="o">.</span><span class="n">delete</span><span class="o">(</span><span class="s">"delete/request"</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span>
    <span class="n">response</span> <span class="k">=&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">statusCode</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// res4: Int = 200
</span></code></pre>
</div>

<p>Next, read about <a href="02-content-types-and-encoders.html">Content types and Encoders</a></p>


      <footer class="site-footer">
  <span class="site-footer-owner"><a href="">featherbed</a> is maintained by <a href="http://jeremyrsmith.github.io">Jeremy Smith</a>.</span>
  <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/pietromenna/jekyll-cayman-theme">Cayman theme</a> by <a href="http://github.com/jasonlong">Jason Long</a>.</span>
</footer>


    </section>

  </body>
</html>
